OPTION(TERMBOX_LIB_BUILD_SHARED "Build termbox_lib as a shared library (uses fPIC)." OFF)
OPTION(TERMBOX_LIB_BUILD_STATIC "Build termbox_lib static library." ON)

IF(BUILD_SHARED_LIBS)
  SET(TERMBOX_LIB_BUILD_SHARED ON)
ENDIF(BUILD_SHARED_LIBS)

SET( PUBLIC_HEADERS ${CMAKE_CURRENT_LIST_DIR}/termbox.h)

SOURCE_GROUP( "Public API" FILES ${PUBLIC_HEADERS} )

SET(termbox_sources
  ${CMAKE_CURRENT_LIST_DIR}/termbox.c
  ${CMAKE_CURRENT_LIST_DIR}/utf8.c
  ${CMAKE_CURRENT_LIST_DIR}/bytebuffer.inl
  ${CMAKE_CURRENT_LIST_DIR}/input.inl
  ${CMAKE_CURRENT_LIST_DIR}/term.inl)

IF(TERMBOX_LIB_BUILD_SHARED)
    ADD_DEFINITIONS( -DTERMBOX_DLL_BUILD )
    ADD_LIBRARY(termbox_lib SHARED ${PUBLIC_HEADERS} ${termbox_sources})
    SET_TARGET_PROPERTIES(termbox_lib PROPERTIES COMPILE_FLAGS -fPIC)

    INSTALL( TARGETS termbox_lib ${INSTALL_EXPORT}
         RUNTIME DESTINATION ${RUNTIME_INSTALL_DIR}
         LIBRARY DESTINATION ${LIBRARY_INSTALL_DIR}
         ARCHIVE DESTINATION ${ARCHIVE_INSTALL_DIR})

    IF(NOT CMAKE_VERSION VERSION_LESS 2.8.11)
        TARGET_INCLUDE_DIRECTORIES( termbox_lib PUBLIC
                                   $<INSTALL_INTERFACE:${INCLUDE_INSTALL_DIR}>
                                   $<BUILD_INTERFACE:${PUBLIC_HEADERS}>)
    ENDIF(NOT CMAKE_VERSION VERSION_LESS 2.8.11)

ENDIF()

IF(TERMBOX_LIB_BUILD_STATIC)
    ADD_LIBRARY(termbox_lib_static STATIC ${PUBLIC_HEADERS} ${termbox_sources})

    INSTALL( TARGETS termbox_lib_static ${INSTALL_EXPORT}
         RUNTIME DESTINATION ${RUNTIME_INSTALL_DIR}
         LIBRARY DESTINATION ${LIBRARY_INSTALL_DIR}
         ARCHIVE DESTINATION ${ARCHIVE_INSTALL_DIR})

    IF(NOT CMAKE_VERSION VERSION_LESS 2.8.11)
        TARGET_INCLUDE_DIRECTORIES( termbox_lib_static PUBLIC
                                $<INSTALL_INTERFACE:${INCLUDE_INSTALL_DIR}>
                                $<BUILD_INTERFACE:${CMAKE_CURRENT_LIST_DIR}>)
     ENDIF(NOT CMAKE_VERSION VERSION_LESS 2.8.11)

ENDIF()

INSTALL(FILES ${PUBLIC_HEADERS} DESTINATION ${INCLUDE_INSTALL_DIR})

# Install instructions for this target
IF(TERMBOX_WITH_CMAKE_PACKAGE)
    SET(INSTALL_EXPORT EXPORT termbox)
ELSE(TERMBOX_WITH_CMAKE_PACKAGE)
    SET(INSTALL_EXPORT)
ENDIF(TERMBOX_WITH_CMAKE_PACKAGE)

# add demo applications
ADD_SUBDIRECTORY(demo)
